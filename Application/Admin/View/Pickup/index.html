
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- BEGIN META -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Custom Theme">
    <!-- END META -->

    <!-- BEGIN SHORTCUT ICON -->
    <link rel="shortcut icon" href="__ROOT__/Public/img/favicon.ico">
    <!-- END SHORTCUT ICON -->
    <title>管理收件 - 代步客管理系统</title>


    <!-- BEGIN STYLESHEET -->
    <link href="__ROOT__/Public/css/bootstrap.min.css" rel="stylesheet"><!-- BOOTSTRAP CSS -->
    <link href="__ROOT__/Public/css/bootstrap-reset.css" rel="stylesheet"><!-- BOOTSTRAP CSS -->
    <link href="__ROOT__/Public/assets/font-awesome/css/font-awesome.css" rel="stylesheet"><!-- FONT AWESOME ICON CSS -->
    <link href="__ROOT__/Public/assets/advanced-datatable/media/css/demo_page.css" rel="stylesheet"><!-- BOOTSTRAP ADVANCE DATATABLE  CSS -->
    <link href="__ROOT__/Public/assets/advanced-datatable/media/css/demo_table.css" rel="stylesheet"><!-- BOOTSTRAP ADVANCE DATATABLE CSS -->
    <link rel="stylesheet" href="__ROOT__/Public/assets/data-tables/DT_bootstrap.css"><!-- BOOTSTRAP DATATABLE CSS -->
    <link href="__ROOT__/Public/css/style.css" rel="stylesheet"><!-- THEME BASIC CSS -->
    <link href="__ROOT__/Public/css/style-responsive.css" rel="stylesheet"><!-- THEME RESPONSIVE CSS -->
    <!--[if lt IE 9]>
    <script src="__ROOT__/Public/js/html5shiv.js"></script>
    <script src="__ROOT__/Public/js/respond.min.js"></script>
    <![endif]-->
    <!-- END STYLESHEET -->
</head>
<body>
<!-- BEGIN SECTION -->
<section id="container" class="">

    <!-- BEGIN HEADER -->
    <include file="./Application/Common/Common/header.html" />
    <!-- END HEADER -->

    <!-- BEGIN SIDEBAR -->
    <include file="./Application/Common/Common/sidebar.html" />
    <!-- END SIDEBAR -->

    <!-- BEGIN MAIN CONTENT -->
    <section id="main-content">

        <section class="wrapper site-min-height">
            <!-- BEGIN PANEL SECTION -->
            <section class="panel">
                <header class="panel-heading">
                    <span class="label label-primary">订单查看</span>
                     <span class="tools pull-right">
                     <a href="javascript:;" class="fa fa-chevron-down"></a>
                     <a href="javascript:;" class="fa fa-times"></a>
                     </span>
                </header>
                <div class="panel-body">
                    <div class="clearfix">
                        <div class="btn-group pull-right">
                            <button class="btn btn-primary dropdown-toggle" data-toggle="dropdown">工 具 <i class="fa fa-angle-down"></i>
                            </button>
                            <ul class="dropdown-menu pull-right">
                                <li><a href="{:U('admin/pickup/export')}">导出Excel</a></li>

                            </ul>
                        </div>
                    </div>
                    <div class="adv-table table-responsive">
                        <table  class="display table table-bordered" id="hidden-table-info">
                            <thead>
                            <tr>
                                <th></th>
                                <th>订单id</th>
                                <th>用户id</th>
                                <th>姓 名</th>
                                <th>手机号码</th>
                                <th>快递公司</th>
                                <th>快递类型</th>
                                <th>快递价格</th>
                                <th>下单时间</th>
                                <th>状 态</th>
                                <th>编 辑</th>
                            </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </section>
            <!-- END PANEL SECTION -->
        </section>
    </section>
    <!-- END MAIN CONTENT -->

    <!-- BEGIN FOOTER -->
    <include file="./Application/Common/Common/footer.html" />
    <!-- END FOOTER -->
</section>
<!-- END SECTION -->

<!-- BEGIN JS -->
<script language="javascript" src="__ROOT__/Public/assets/advanced-datatable/media/js/jquery.js"></script><!-- ADVANCE DATATABLE JS -->
<script src="__ROOT__/Public/js/bootstrap.min.js" ></script><!-- BOOTSTRAP JS -->
<script class="include"  src="__ROOT__/Public/js/jquery.dcjqaccordion.2.7.js"></script><!-- ACCORDING JS -->
<script src="__ROOT__/Public/js/jquery.scrollTo.min.js" ></script><!-- SCROLLTO JS -->
<script src="__ROOT__/Public/js/jquery.nicescroll.js" ></script><!-- NICESCROLL JS -->
<script src="__ROOT__/Public/js/respond.min.js" ></script><!-- RESPOND JS -->
<script language="javascript" src="__ROOT__/Public/assets/advanced-datatable/media/js/jquery.dataTables.js"></script><!-- ADVANCE DATATABLE JS -->
<script  src="__ROOT__/Public/assets/data-tables/DT_bootstrap.js"></script><!-- DATATABLE JS -->
<script src="__ROOT__/Public/js/common-scripts.js" ></script><!-- BASIC COMMON JS  -->
<script >
    $("#express_module").addClass("active");
    $("#pickup_manage").addClass("active");

    /* DATATABLE MODIFICATION SCRIPT */
    /* Formating function for row details */
    function fnFormatDetails ( oTable, nTr )
    {
        var aData = oTable.fnGetData( nTr );
        var sOut = '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">';
        sOut += '<tr><td>学 校：</td><td>'+aData['school_name']+'</td></tr>';
        sOut += '<tr><td>寝 室：</td><td>'+aData['dormitory_address']+'</td></tr>';
        sOut += '<tr><td>快递短信：</td><td>'+aData['express_sms']+'</td></tr>';
        sOut += '<tr><td>取件码/货架号/手机号：</td><td>'+aData['express_code']+'</td></tr>';
        sOut += '<tr><td>备 注：</td><td>'+aData['remarks']+'</td></tr>';
        sOut += '</table>';

        return sOut;
    }

    $(document).ready(function() {

        /*
         * Initialse DataTables, with no sorting on the 'details' column
         */
        var oTable = $('#hidden-table-info').dataTable({
            autoWidth: false,
            //open server side
            serverSide: true,
            stateSave: true,
            "ajax": {
                "url": "{:U('admin/pickup/get')}"
            },
            "searching": true,
            columns: [
                {"data": "look", "orderable": false},
                {"data": "pickup_id", "orderable": false},
                {"data": "openid", "orderable": true},
                {"data": "receiver_name", "orderable": false},
                {"data": "receiver_phone", "orderable": true},
                {"data": "express_company", "orderable": true},
                {"data": "express_type", "orderable": true},
                {"data": "price", "orderable": false},
                {"data": "time", "orderable": false},
                {"data": "express_status", "orderable": false},
                {"data": "edit", "orderable": false},
            ],
            "oLanguage": {
                "sProcessing": "正在加载中......",
                "sLengthMenu": "每页显示 _MENU_ 条记录",
                "sZeroRecords": "对不起，查询不到相关数据！",
                "sEmptyTable": "表中无数据存在！",
                "sInfo": "当前显示 _START_ 到 _END_ 条，共 _TOTAL_ 条记录",
                "sInfoFiltered": "数据表中共为 _MAX_ 条记录",
                "sSearch": "搜索",
                "oPaginate": {
                    "sFirst": "首页",
                    "sPrevious": "上一页",
                    "sNext": "下一页",
                    "sLast": "末页"
                }
            }
        });


        /* Add event listener for opening and closing details
         * Note that the indicator for showing whi ch row is open is not controlled by DataTables,
         * rather it is done here
         */
        $('#hidden-table-info tbody td img').live('click', function (e) {
            var nTr = $(this).parents('tr')[0];
            if (oTable.fnIsOpen(nTr)) {
                /* This row is already open - close it */
                this.src = "__ROOT__/Public/assets/advanced-datatable/examples/examples_support/details_open.png";
                oTable.fnClose(nTr);
            }
            else {
                /* Open this row */
                this.src = "__ROOT__/Public/assets/advanced-datatable/examples/examples_support/details_close.png";
                oTable.fnOpen(nTr, fnFormatDetails(oTable, nTr), 'details');
            }
        });

        $('#hidden-table-info a.complete').live('click', function (e) {
            e.preventDefault();
            var nRow = $(this).parents('tr')[0];
            var jqInputs = $('td', nRow);

            //修改状态
            $.get("{:U('admin/pickup/updateStatus')}", {
                        'pickup_id': jqInputs[1].innerHTML
                    },
                    function (data) {
                        if (data['result'] == 1) {
                            jqInputs [9] = "<div style='color:green'>已完成</div>";
                            jqInputs [10] = "<a><span class=\"label label-default\">完 成</span></a>";

                            oTable.fnUpdate(jqInputs[9].value, nRow, 9, false);
                            oTable.fnUpdate(jqInputs[10].value, nRow, 10, false);

                            oTable.fnDraw();
                        }
                    });
        });
    });


</script>
<!-- END JS -->
</body>
</html>


