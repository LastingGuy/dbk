
<!DOCTYPE html>
<html lang="en">
<head>
    <!-- BEGIN META -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Custom Theme">
    <!-- END META -->

    <!-- BEGIN SHORTCUT ICON -->
    <link rel="shortcut icon" href="__ROOT__/Public/img/favicon.ico">
    <!-- END SHORTCUT ICON -->
    <title>管理商城 - 代步客管理系统</title>


    <!-- BEGIN STYLESHEET -->
    <link href="__ROOT__/Public/css/bootstrap.min.css" rel="stylesheet"><!-- BOOTSTRAP CSS -->
    <link href="__ROOT__/Public/css/bootstrap-reset.css" rel="stylesheet"><!-- BOOTSTRAP CSS -->
    <link href="__ROOT__/Public/assets/font-awesome/css/font-awesome.css" rel="stylesheet"><!-- FONT AWESOME ICON CSS -->
    <link href="__ROOT__/Public/assets/advanced-datatable/media/css/demo_table.css" rel="stylesheet"><!-- BOOTSTRAP ADVANCE DATATABLE CSS -->
    <link rel="stylesheet" type="text/css" href="__ROOT__/Public/assets/bootstrap-datetimepicker/css/datetimepicker.css"><!-- DATETIMEPICKER PLUGIN CSS -->
    <link href="__ROOT__/Public/css/style.css" rel="stylesheet"><!-- THEME BASIC CSS -->
    <link href="__ROOT__/Public/css/style-responsive.css" rel="stylesheet"><!-- THEME RESPONSIVE CSS -->
    <!--[if lt IE 9]>
    <script src="__ROOT__/Public/js/html5shiv.js"></script>
    <script src="__ROOT__/Public/js/respond.min.js"></script>
    <![endif]-->
    <!-- END STYLESHEET -->

</head>
<body>
<!-- BEGIN SECTION -->
<section id="container" class="">

    <!-- BEGIN HEADER -->
    <include file="./Application/Common/Common/header.html" />
    <!-- END HEADER -->

    <!-- BEGIN SIDEBAR -->
    <include file="./Application/Common/Common/sidebar.html" />
    <!-- END SIDEBAR -->

    <!-- BEGIN MAIN CONTENT -->
    <section id="main-content">

        <section class="wrapper site-min-height">
            <!-- BEGIN PANEL SECTION -->
            <section class="panel">
                <header class="panel-heading">
                    <span class="label label-primary">商品查看</span>
                     <span class="tools pull-right">
                     <a href="javascript:;" class="fa fa-chevron-down"></a>
                     <a href="javascript:;" class="fa fa-times"></a>
                     </span>
                </header>
                <div class="panel-body">

                    <div class="clearfix">
                        <div class="btn-group ">
                            <button type="button" class="btn btn-danger" data-toggle="modal"
                                    data-target="#myModal">添加商品
                            </button>
                        </div>
                    </div>
                    <div class="adv-table table-responsive">
                        <table  class="display table table-bordered" id="hidden-table-info">
                            <thead>
                            <tr>
                                <th></th>
                                <th>商品id</th>
                                <th>商品名</th>
                                <th>价 格</th>
                                <th>浏览量</th>
                                <th>商品类型</th>
                                <th>增加时间</th>
                                <th>上线情况</th>
                                <th>编 辑</th>
                                <th>上 线</th>
                            </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </section>
            <!-- END PANEL SECTION -->
        </section>
    </section>
    <!-- END MAIN CONTENT -->

    <!-- BEGIN FOOTER -->
    <include file="./Application/Common/Common/footer.html" />
    <!-- END FOOTER -->
</section>
<!-- END SECTION -->
<!-- 模态框（Modal）-->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close"
                        data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    添加商品
                </h4>
            </div>
            <div class="modal-body">
                <form action="#" class="form-horizontal tasi-form">
                    <div class="form-group">
                        <label class="col-md-4 control-label"> &nbsp;&nbsp;&nbsp;商 品 名</label>
                        <div class="col-md-5 col-xs-11">
                            <input id="goods_name" type="text" placeholder="请输入商品名" class="form-control">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-4 control-label"> &nbsp;&nbsp;&nbsp;商 品 价 格</label>
                        <div class="col-md-5 col-xs-11">
                            <input id="goods_price" type="text" placeholder="请输入商品价格" class="form-control">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-4 control-label"> &nbsp;&nbsp;&nbsp;商 品 链 接</label>
                        <div class="col-md-5 col-xs-11">
                            <input id="goods_link" type="text" placeholder="请输入商品链接" class="form-control">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-4 control-label"> &nbsp;&nbsp;&nbsp;商 品 描 述</label>
                        <div class="col-md-6 col-xs-11">
                            <textarea id="goods_description" rows="5" cols="70" class="form-control"></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-4 control-label"> &nbsp;&nbsp;&nbsp;一 级 分 类</label>
                        <div class="col-md-6 col-xs-11">
                            <select id="classify1" class="form-control" name="classify1" onchange="getClassify2($(this))">
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-4 control-label"> &nbsp;&nbsp;&nbsp;二 级 分 类</label>
                        <div class="col-md-6 col-xs-11">
                            <select id="classify1_2" class="form-control" name="classify1_2">
                            </select>
                        </div>
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button id="close" type="button" class="btn btn-default"
                        data-dismiss="modal">关 闭
                </button>
                <button type="button" class="btn btn-primary" onclick="submit()">
                    提 交
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>
<div class="modal fade" id="myModal2" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close"
                        data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title">
                    编辑商品
                </h4>
            </div>
            <div class="modal-body">
                <form action="#" class="form-horizontal tasi-form">
                    <div class="form-group">
                        <label class="col-md-4 control-label"> &nbsp;&nbsp;&nbsp;商 品 id</label>
                        <div class="col-md-5 col-xs-11">
                            <input id="goods_id2" type="text" placeholder="请输入商品名" class="form-control" readonly>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-4 control-label"> &nbsp;&nbsp;&nbsp;商 品 名</label>
                        <div class="col-md-5 col-xs-11">
                            <input id="goods_name2" type="text" placeholder="请输入商品名" class="form-control">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-4 control-label"> &nbsp;&nbsp;&nbsp;商 品 价 格</label>
                        <div class="col-md-5 col-xs-11">
                            <input id="goods_price2" type="text" placeholder="请输入商品价格" class="form-control">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-4 control-label"> &nbsp;&nbsp;&nbsp;商 品 链 接</label>
                        <div class="col-md-5 col-xs-11">
                            <input id="goods_link2" type="text" placeholder="请输入商品链接" class="form-control">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-4 control-label"> &nbsp;&nbsp;&nbsp;商 品 描 述</label>
                        <div class="col-md-6 col-xs-11">
                            <textarea id="goods_description2" rows="5" cols="70" class="form-control"></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-4 control-label"> &nbsp;&nbsp;&nbsp;一 级 分 类</label>
                        <div class="col-md-6 col-xs-11">
                            <select id="eclassify1" class="form-control" name="classify1" onchange="getClassify2($(this),null)">
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-md-4 control-label"> &nbsp;&nbsp;&nbsp;二 级 分 类</label>
                        <div class="col-md-6 col-xs-11">
                            <select id="eclassify1_2" class="form-control" name="eclassify1_2">
                            </select>
                        </div>
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button id="close2" type="button" class="btn btn-default"
                        data-dismiss="modal">关 闭
                </button>
                <button type="button" class="btn btn-primary" onclick="update()">
                    编 辑
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>


<!-- BEGIN JS -->
<script language="javascript" src="__ROOT__/Public/assets/advanced-datatable/media/js/jquery.js"></script><!-- ADVANCE DATATABLE JS -->
<script src="__ROOT__/Public/js/bootstrap.min.js" ></script><!-- BOOTSTRAP JS -->
<script class="include"  src="__ROOT__/Public/js/jquery.dcjqaccordion.2.7.js"></script><!-- ACCORDING JS -->
<script src="__ROOT__/Public/js/jquery.scrollTo.min.js" ></script><!-- SCROLLTO JS -->
<script src="__ROOT__/Public/js/jquery.nicescroll.js" ></script><!-- NICESCROLL JS -->
<script src="__ROOT__/Public/js/respond.min.js" ></script><!-- RESPOND JS -->
<script language="javascript" src="__ROOT__/Public/assets/advanced-datatable/media/js/jquery.dataTables.js"></script><!-- ADVANCE DATATABLE JS -->
<script  src="__ROOT__/Public/assets/data-tables/dataTables.bootstrap.min.js"></script><!-- DATATABLE JS -->
<script src="__ROOT__/Public/assets/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js"></script><!-- BOOTSTRAP DATETIMEPICKER JS  -->
<script src="__ROOT__/Public/assets/bootstrap-datetimepicker/js/locale/bootstrap-datetimepicker.zh-CN.js"></script>
<script src="__ROOT__/Public/js/common-scripts.js" ></script><!-- BASIC COMMON JS  -->


<script >
    $("#mall_module").addClass("active");
    $("#mall_manage").addClass("active");

    /* DATATABLE MODIFICATION SCRIPT */
    /* Formating function for row details */
    function fnFormatDetails ( oTable, nTr )
    {
        var aData = oTable.fnGetData( nTr );
        var sOut = '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">';
        sOut += '<tr><td>链 接：</td><td>'+aData['goods_link']+'</td></tr>';
        sOut += '<tr><td>描 述：</td><td>'+aData['goods_description']+'</td></tr>';
        sOut += '</table>';

        return sOut;
    }

    function getClassify1(obj){

        obj.empty();
        $.get("{:U('admin/mall/getClassify1')}", {
                },
                function (data) {
                    var html = "<option value=''>请选择</option>";
                    obj.append(html);
                    for(var i in data){
                        html = "<option value='"+i+"'>"+data[i]+"</option>";
                        obj.append(html);
                    }
                });
    }

    function getClassify2(object,value){
        var classify1 = object.val();
        var str;
        if(object.context.id!=undefined)
            str = "#"+object.context.id+"_2";
        else
            str = object.selector+"_2";
        var selector = $(""+str);
        selector.empty();
        if(classify1==""){
            return ;
        }
        $.get("{:U('admin/mall/getClassify2')}", {
            'classify1': classify1
                },
                function (data) {
                    var html;
                    for(var i in data){
                        html = "<option value='"+i+"'>"+data[i]+"</option>";
                        selector.append(html);
                    }
                    if(value!=null)
                        selector.val(value);
                });
    }

    var oTable;

    $(document).ready(function() {

        getClassify1($('#classify1'));
        getClassify1($('#eclassify1'));
        var dropDown = "<span class='dropdown'>"+
                "<a class='label label-success dropdown-toggle' href='javascript:;' id='dropdownMenu1' data-toggle='dropdown'>"+
                " 选 择 "+
                "<span class='caret'></span>"+
                "</a>"+
                "<ul class='dropdown-menu' role='menu' aria-labelledby='dropdownMenu1'>"+
                "<li role='presentation'><a class='changeStatus' data-status=0 role='menuitem' tabindex='-1'>下线</a></li>"+
                "<li role='presentation'><a class='changeStatus' data-status=1 role='menuitem' tabindex='-1'>上线</a></li>"+
                "</ul></span>";
        var editButton = "<a class='label label-success edit' href='javascript:;' type='button'  data-toggle='modal' data-target='#myModal2'>编 辑</a>";

        /*
         * Initialse DataTables, with no sorting on the 'details' column
         */
            oTable = $('#hidden-table-info').dataTable({
            bDeferRender: true,
            paging: true,//分页
            "pagingType": "simple_numbers",
            autoWidth: false,
            //open server side
            serverSide: true,
            stateSave: true,
            "ajax": {
                "url": "{:U('admin/mall/get')}"
            },
            "searching": true,
            columns: [
                {"data": "look", "orderable": false},
                {"data": "goods_id", "orderable": false},
                {"data": "goods_name", "orderable": false},
                {"data": "goods_price", "orderable": true},
                {"data": "goods_page_view", "orderable": true},
                {"data": function data( row, type, set, meta ){
                    return row['classify1_description']+" "+row['classify2_description'];
                }, "orderable": false},
                {"data": "goods_time", "orderable": false},
                {"data": "goods_online", "orderable": false,
                    'render': function (data, type, full, meta) {
                        if(data=='0')
                            return '<span style="color:red;">下线</span>';
                        else if(data=='1')
                            return '<span style="color:dodgerblue;">上线</span>'
                    }},
                {"data": "edit", "orderable": false,
                    'render': function(data, type, full, meta){
                        return editButton;
                    }},
                {"data": "online", "orderable": false,
                    'render' :function(data, type, full, meta){
                        return dropDown;
                    }
                }
            ],
            "oLanguage": {
                "sProcessing": "正在加载中......",
                "sLengthMenu": "每页显示 _MENU_ 条记录",
                "sZeroRecords": "对不起，查询不到相关数据！",
                "sEmptyTable": "表中无数据存在！",
                "sInfo": "当前显示 _START_ 到 _END_ 条，共 _TOTAL_ 条记录",
                "sInfoFiltered": "数据表中共为 _MAX_ 条记录",
                "sSearch": "搜索",
                "oPaginate": {
                    "sFirst": "首页",
                    "sPrevious": "上一页",
                    "sNext": "下一页",
                    "sLast": "末页"
                }
            }
        });


        /* Add event listener for opening and closing details
         * Note that the indicator for showing whi ch row is open is not controlled by DataTables,
         * rather it is done here
         */
        $('#hidden-table-info tbody td img').live('click', function (e) {
            var nTr = $(this).parents('tr')[0];
            if (oTable.fnIsOpen(nTr)) {
                /* This row is already open - close it */
                this.src = "__ROOT__/Public/assets/advanced-datatable/examples/examples_support/details_open.png";
                oTable.fnClose(nTr);
            }
            else {
                /* Open this row */
                this.src = "__ROOT__/Public/assets/advanced-datatable/examples/examples_support/details_close.png";
                oTable.fnOpen(nTr, fnFormatDetails(oTable, nTr), 'details');
            }
        });


        $('#hidden-table-info a.changeStatus').live('click', function (e) {
            var status = $(this).attr('data-status');
            var nRow = $(this).parents('tr')[0];
            var jqInputs = $('td', nRow);

            //修改状态
            $.get("{:U('admin/mall/updateOnline')}", {
                        'goods_id': jqInputs[1].innerHTML,
                        'goods_online': status
                    },
                    function (data) {
                        oTable.fnDraw(false);
                    });
        });

        $('#hidden-table-info a.edit').live('click', function (e) {
            var nRow = $(this).parents('tr')[0];
            var jqInputs = $('td', nRow);

            //修改状态
            $.get("{:U('admin/mall/getOneGoods')}", {
                        'goods_id': jqInputs[1].innerHTML
                    },
                    function (data) {
                        $("#goods_id2").val(data['goods_id']);
                        $("#goods_name2").val(data['goods_name']);
                        $("#goods_price2").val(data['goods_price']);
                        $("#goods_link2").val(data['goods_link']);
                        $("#goods_description2").val(data['goods_description']);
                        $("#eclassify1").val(data['classify1_id']);
                        getClassify2($("#eclassify1"),data['classify2_id']);
                    });
        });
    });

    function submit(){
        $.post("{:U('admin/mall/add')}", {
                    goods_name: $('#goods_name').val(),
                    goods_price: $('#goods_price').val(),
                    goods_link: $('#goods_link').val(),
                    goods_description: $("#goods_description").val(),
                    classify2_id: $("#classify1_2").val()
                },
                function(data){
                    $('#close').click();
                    if(data>=0){
                        alert('添加成功!');
                    }
                    oTable.fnDraw(false);
                });

    }

    function update(){
        $.post("{:U('admin/mall/update')}", {
                    goods_id: $('#goods_id2').val(),
                    goods_name: $('#goods_name2').val(),
                    goods_price: $('#goods_price2').val(),
                    goods_link: $('#goods_link2').val(),
                    goods_description: $("#goods_description2").val(),
                    classify2_id: $("#eclassify1_2").val()
                },
                function(data){
                    $('#close2').click();
                    if(data>=1){
                        alert('编辑成功!');
                    }
                    oTable.fnDraw(false);
                });
    }

</script>
<!-- END JS -->
</body>
</html>


